var fs = require('fs'),
    error= require('./lib/error'),
    insert = require('./lib/insert').init,
    select = require('./lib/select').init,
    update = require('./lib/update').init,
    db_path = __dirname+'/db_files';

//errors
error.init({
    100: {
        message: 'Database does not exist',
        suggestions: 'Try runing the db.createDatabase, db.databaseExists or db.listDatabases function'
    },
    101:{
        message: 'Names may only contain a-z or 0-9',
        suggestions: 'Remove the limited charicters from the name'
    },
    102: {
        message: 'Database already exists',
        suggestions: 'Try a different name, or before creatin a database run db.databaseExists'
    }
});


//db function
exports.db = function(db_name) {
    return new this.db.init(db_name);
};
exports.db.listDatabases = function(callback) {
    fs.readdir(path, function(err, db_file_list) {
        var i = 0,
            db_item, db_list = [];

        for (; i < db_file_list.length; i++) {
            db_item = db_file_list[i].split('.');
            if (db_item[1] !== 'json') {
                continue;
            }
            else {
                db_list[db_list.length] = db_item[0];
            }
        }
        callback(db_list);
    });
};
exports.db.databaseExists = function(name, callback) {
    fs.readdir(path, function(err, db_file_list) {
        var i = 0,
            db_item, db_list = [];

        for (; i < db_file_list.length; i++) {
            db_item = db_file_list[i].split('.');
            if (db_item[0] === name) {
                callback(true);
                return;
            }
        }
        callback(false);
    });
};
exports.db.createDatabase = function(name, callback){
    if(name.indexOf('.'))
    exports.db.databaseExists(name, function(exists){
        if(exists){
            error.logError(101);
            callback(false);
            return false;
        }
        fs.writeFile(path+'/'+name+'.json','{}','utf-8',function(err){
            callback(true);
        });
    });
    
};
exports.db.init = function(db_name,callback) {
    exports.db.databaseExists(db_)
    var db_file = fs.readFileSync(path+'/' + db_name + '.json');
    if (!db_file) {
        error.logError(100);
        return false;
    }
};
debugger;